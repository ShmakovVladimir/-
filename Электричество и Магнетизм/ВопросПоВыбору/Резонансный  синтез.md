**Шмаков Владимир ФФКЭ - группа Б04-105**
**МФТИ - декабрь 2022**

### Введение

Для синтеза звука придумано большое количество электрических схем. И существует множество техник аналогового синтеза. Самыми популярными техниками являются субстрактивный и аддитивный синтез.

Основным элементом субсрактивного синтезатора является фильтр. Благодаря нему из сложного колебания осциллятора(обычно используется пилообразная форма волны или меандр) выделяется нужный сигнал.

В аддитивных синтезаторах - наоборот - сигнал осциллятора не богатый гармонически(синусоида/треугольная форма волны). Гармоники добавляются сложением колебаний множества осцилляторов, либо пропусканием одного осциллятора через специальные схемы(например схему вейвфолдера).

Все эти вышеописанные типы синтеза невозможны без одной составляющей - генератора огибающей. Именно благодаря ней можно варьировать спектральный состав сигнала во времени, а также задавать зависимость амплитуды(громкости) колебаний от времени.

В 20е-50е годы сборка генератора огибающей было сложной задачей. Однако даже без этой схемы в СССР выпускались фильмы с электронным звуковым сопровождением(например «Человек - Амфибия», мультфильм «Вор»). Одно из устройств, использовавшихся для синтеза звука в те годы и рассмотрено в работе(cхема не идентична схемам тех лет).

О чем идет речь? Рассмотрим звук, издаваемый каким-либо объектом из нашего мира. Например - постучим по чашке. Чашка начинает звучать всего на определённом наборе частот, которые обуславливаются геометрией и граничными условиями. Другими словами, из большого спектра стука чашка выбирает лишь определённые. 

Именно на этом принципе и построен 

### Цель работы

- Создать устройство для синтеза звуков. Сигналы устройства могут быть использованы для синтеза ударных и мелодических инструментов. Устройство может являться частью большого инструмента и выступать в роли фильтра/генератора.
- Описать работу устройства, и составить математическую модель. Модель может быть полезна для настройки схемы с помощью цифровых технологий.

### Оборудование
- Радиодетали:
	- Два конденсатора ёмкостью $0.1 \ \mu F$
	- Конденсатор небольшой ёмкости(для сглаживания сигнала кнопки) - я использовал керамический конденсатор ёмкостью $22 \ p F$
	- Два потенциометра на $10 \ кОм$ 
	- Резисторы:
		- $100 \ кОм$ - 4 штуки
		- $4.7 \ кОм$ - 2 штуки
	- Кнопка
	- Источник питания - использовалась батарейка «крона» с напряжением $9 V$
	- Операционный усилитель $TL071$ - использовал «половинку» $TL072$
- Приборы:
	- Диктофон
	- Мультиметр(для измерения сопротивления)
	- Компьютер(для подачи сигнала на цепь и обработки результатов)
- Программное обеспечение:
	- Интерпретатор языка Python
	- Библиотека numpy - для вычислений и построения графиков
	- Библиотека matplotlib - построение графиков
	- Библиотека scipy - чтение `wav` файлов, разложение сигналов в ряд Фурье с помощью алгоритма fft(fast forier transform)
	- Сайт https://www.circuit-diagram.org - для разведения схемы
	- Плагин bogaudio noise - для генерации белого шума

## Теоретические сведения

##### Линейная фильтрация

**Фильтр** - устройство для выделения желаемого диапазона спектра из спектра входного сигнала. Аналоговые фильтры делят на несколько основных категорий:

![[filter types.svg | center]]
> классификация фильтров по типу амплитудно - частотной характеристики

Пусть:
- $f(t)$ - непрерывная функция - входной сигнал
- $\hat{L}$ - оператор, действующий на пространстве непрерывных функций - описывает работу фильтра
- $g(t)$ - отклик фильтра - результат оператора $\hat{L}$ на функции $f$: $g(t) = \hat{L} f(t)$

Назовём фильтр **линейным**, если для оператора $\hat{L}$ верно свойство линейности:
$$
\hat{L}(c_{1}f_{1} + c_{2}f_{2}) = c_{1}\hat{L}f_{1} + c_{2}\hat{L}f_{2}
$$
Таким образом, для расчета отклика линейного фильтра нужно знать только гармонический состав входного сигнала $f(t)$

##### RC цепь - фильтр высоких и низких частот

![[LPFandHPF.svg | center]]
Фильтры состоят из последовательно соединенных резистора и конденсатора. В случае $RC$ фильтра высоких частот напряжение снимается с резистора. В фильтре низких частот напряжение снимаем с конденсатора.

Методом комплексных амплитуд можем вывести АЧХ и ФЧХ фильтра высоких и низких частот.

АЧХ и ФЧХ фильтра низких частот представлено формулой ниже:

$$
U_{out} = U_{in} \frac{X_{c}}{\sqrt{R^2 + X_{C}^2}} \ , X_{C} = \frac{1}{2 \pi \nu C} \ , \phi(\omega) = -arctg(\omega R C)
$$

Для фильтра высоких частот:
$$
U_{out} = U_{in} \frac{R}{\sqrt{R^2 + X_{C}^2}} \ , X_{C} = \frac{1}{2 \pi \nu C}\ , \phi(\omega) = arctg\left(\frac{1}{\omega R C}\right)
$$
##### Отклик фильтров на $\delta$ импульс

Свободные колебания в $RC$ цепочках затухают на $99 \%$ за время $t = 5\tau = 5RC$:

![[Pasted image 20221227070635.png | center]]

Полоса пропускания(на уровне $-3 Db$): $\Delta w = 1/RC$. 

##### Операционный усилитель в режиме неинвертирующего усилителя

Операционный усилитель - достаточно сложное устройство, для описания которого требуется немало времени. В этой работе нам пригодится схема, изображенная на рисунке ниже:

![[Pasted image 20221227072401.jpg | center]]

Коэффициент усиления ОУ в таком режиме работы находится по формуле:
$$
k = 1 + \frac{R_{2}}{R_{1}}
$$

### Методика

##### Описание экспериментальной установки

Для получения нужной АЧХ совместим интегрирующую и дифференцирующую $RC$  цепочки:


![[LPF_sum_HPF.svg | center]]

Так, мы получили пассивный фильтр узкой полосы. Его главный минус заключается в маленькой амплитуде выходного сигнала(в силу падения напряжения на элементах). Так-же данная схема не может поддерживать колебания самостоятельно. 

Чтобы убрать вышеперечисленные недостатки, добавим в схему операционный усилитель(в режиме неинвертирующего усилителя):

![[filters and gain.svg | center ]]
> блок-схема устройства 

Будем использовать переменные резисторы c максимальным сопротивлением. Нужно подобрать ёмкость конденсатора так, чтобы частота среза($1/2 \pi RC$) удобно регулировалась на интервале слышимых частот(см. блокнот). Наилучшим образом подходит емкость $50 \ nF$. Ближайшее к этому значению ёмкость(из доступных мне) - $100 \ nF$. 

Также необходимо подобрать коэффициент усиления так, чтобы колебания системы были различимы на фоне шума. Остановимся на коэффициенте $k = 1+ 100/4.7 = 22.3$. 

Итоговую схема устройства:

![[circuit.svg | center | 800]]
> итоговая схема

Для схемы построена теоретическая модель(см. блокнот):

![[Pasted image 20221228002658.png | center ]]
![[Pasted image 20221228002744.png | center]]


##### Эксперимент 1 - «режим самовозбуждения»
В этом режиме устройство поддерживает колебания самостоятельно. Похожим образом устроены осцилляторы синтезаторов $70 - 80х$ годов. Например, схема осциллятора «Twin-T»:

![[Pasted image 20221228000156.png | center | 400]]


Соеденим выход устройства с входом, через небольшое сопротивление($R_{3} = 220 \ Ом$). Колебания будем возбуждать нажатием на кнопку(сигнал которой выведен на вход):

![[feedback_loop.svg | center | ]]

Получили так называемую петлю обратной связи. Теперь фильтр работает как осциллятор 
- При нажатии на кнопку, на вход цепи подаётся сигнал с широким спектром.(см. теоретическую часть)
- Из широкого спектра выделяется только узкий диапазон частот(ширина зависит от сопротивления $R_{2}$ и $R_{1}$) - их амплитуда возрастает. Амплитуда остальных гармоник падает
- Выходной сигнал смешивается с сигналом на входе(при этом стоит учитывать фазовый сдвиг гармоник)
- Итоговый сигнал опять пропускается через схему - амплитуда «нужных» гармоник возрастает.

Изменение спектрального состава выходного сигнала можно продемонстрировать на схеме:

![[Сужение спектра.svg | center]]

Из-за обратной связи изначальный АЧХ «сужается и вытягивается».

На входе сигналы цепи сигналы могут смешиваться в разных фазах. Увеличение амплитуды зависит от разности фаз сигналов. Наибольшая амплитуда получается в том случае, если разность фаз - $0 \degree$: 

![[sin_sum_0.png]]

Такая разность достигается на частоте:
$$
F = \frac{1}{2 \pi C \sqrt{R_{1}} \sqrt{R_{2}}}
$$

Чем больше сдвиг - тем меньше суммарная амплитуда:

![[sin_sum_45.png | center]]

##### Эксперимент 2 - АЧХ фильтров

Будем использовать устройство в качестве фильтра. На вход цепи подадим белый шум. В качестве генератора используется аудиокарта компьютера и плагин «bogaudio noise». 

![[noiseExperiment.svg | center]]


### Обработка результатов

Для обработки результатов используем библиотеку «scipy», а именно её модуль «fft». Функции библиотеки позволяют раскладывать в ряд сигналы, записанные в wav файлах.

##### Результаты первого эксперимента

В первом эксперименте было зафиксировано три сигнала - «низкочастотная колебания с широким спектром», «синусоидальные колебания(узкий спектр вырезаемых частот)», «синусоидальное колебание и несколько обертонов».

Формы волны и спектры полученных сигналов представлены на графиках ниже:

![[sig1.png | center]]

![[Электричество и Магнетизм/ВопросПоВыбору/Plots/exp1.png | center]]
> Форма волны и спектр первого сигнала

![[sig2.png | center]]

![[Электричество и Магнетизм/ВопросПоВыбору/Plots/exp2.png | center]]
> форма волны и спектр второго сигнала

![[sig3.png | center]]

![[Электричество и Магнетизм/ВопросПоВыбору/Plots/exp3.png | center]]
> форма волны и спектр третьего сигнала

Спектры полученных сигналов коррелируют с амплитудно - частотной характеристикой цепи. Из-за обратной связи АЧХ сигнала на выходе «вытягивается» по сравнению с АЧХ фильтра. 

При большой добротности исходного пика($Q > 1500$ - как в эксперименте 2) удается получить на выходе «чистые» синусоидальные колебания.

Фазо - частотная характеристика не так сильно влияет на спектральный состав выходного сигнала. Во втором эксперименте сдвиг по фазе гармоники с наибольшей амплитудой равен примерно $-\pi/6$. В третьем эксперименте максимальную амплитуду имеет гармоника, сдвинутая на $0 \degree$. 

##### Результаты второго эксперимента - фильтрация шума

В этом эксперименте обратная связь отсутствует, а на вход цепи подается белый шум. Устройство работает в качестве фильтра.

Как видим, АЧХ выходного сигнала совпадает с теоретической моделью(повторяет АЧХ цепи):

![[noise1.png | center]]
> спектр шума в эксперименте 1 - получили розовый шум

![[noise2.png | center]]
> результат второго эксперимента


### Вывод


### Приложение

Код может быть найден по ссылке: https://github.com/ShmakovVladimir/Labs

Литература:
- Козел, Локшин - Модулированные колебания, Спектральный Анализ, Линейная фильтрация
- [Документация библиотеки scipy](https://docs.scipy.org/doc/scipy/tutorial/fft.html)
- 